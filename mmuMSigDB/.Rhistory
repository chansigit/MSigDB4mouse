length2 <- function (x, na.rm=FALSE) {
if (na.rm) sum(!is.na(x))
else       length(x)
}
# This does the summary. For each group's data frame, return a vector with
# N, mean, and sd
datac <- ddply(data, groupvars, .drop=.drop,
.fun = function(xx, col) {
c(N    = length2(xx[[col]], na.rm=na.rm),
mean = mean   (xx[[col]], na.rm=na.rm),
sd   = sd     (xx[[col]], na.rm=na.rm)
)
},
measurevar
)
# Rename the "mean" column
datac <- rename(datac, c("mean" = measurevar))
datac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean
# Confidence interval multiplier for standard error
# Calculate t-statistic for confidence interval:
# e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
ciMult <- qt(conf.interval/2 + .5, datac$N-1)
datac$ci <- datac$se * ciMult
return(datac)
}
dfs <- summarySE(df, measurevar="value_added", groupvars=c("year","group"))
dfs <- summarySE(df, measurevar="value_added", groupvars=c("year","group"))
dfs
dfs <- summarySE(df, measurevar="value_added", groupvars=c("year","group"))
dfs
df<- read.csv("S:/æˆ‘çš„åšæžœäº?æˆ‘çš„åšæžœäº?é«˜ä¼Ÿ/ç¨Žè´Ÿè½¬å«é—®é¢˜/mineVSindus13.csv",
header=TRUE, stringsAsFactors=FALSE,sep=",")
df
df<- read.csv("S:/æˆ‘çš„åšæžœäº?æˆ‘çš„åšæžœäº?é«˜ä¼Ÿ/ç¨Žè´Ÿè½¬å«é—®é¢˜/mineVSindus13.csv",
header=TRUE, stringsAsFactors=FALSE,sep=",")
df
head(df)
df<- read.csv("S:/æˆ‘çš„åšæžœäº?æˆ‘çš„åšæžœäº?é«˜ä¼Ÿ/ç¨Žè´Ÿè½¬å«é—®é¢˜/mineVSindus13.csv",
header=TRUE, stringsAsFactors=FALSE,sep=",")
head(df)
dfs <- summarySE(df, measurevar="value_added", groupvars=c("year","group"))
ggplot(dfs, aes(x=year, y=value_added, colour=group)) +
geom_errorbar(aes(ymin=value_added-se, ymax=value_added+se), width=.1) +
geom_line(aes(linetype=group, color=group)) +
geom_point()
library(ggplot2)
ggplot(dfs, aes(x=year, y=value_added, colour=group)) +
geom_errorbar(aes(ymin=value_added-se, ymax=value_added+se), width=.1) +
geom_line(aes(linetype=group, color=group)) +
geom_point()
head(df_feb22)
df_feb22<- read.csv("S:/æˆ‘çš„åšæžœäº?æˆ‘çš„åšæžœäº?é«˜ä¼Ÿ/ç¨Žè´Ÿè½¬å«é—®é¢˜/mineVSindus13_Feb22.csv",
header=TRUE, stringsAsFactors=FALSE,sep=",")
head(df_feb22)
df_feb22<- read.csv("S:/æˆ‘çš„åšæžœäº?æˆ‘çš„åšæžœäº?é«˜ä¼Ÿ/ç¨Žè´Ÿè½¬å«é—®é¢˜/mineVSindus13_Feb22.csv",
header=TRUE, stringsAsFactors=FALSE,sep=",")
head(df_feb22)
dfs <- summarySE(df_feb22, measurevar="profit", groupvars=c("year","group"))
head(df_feb22)
group
head(df_feb22)
dfs <- summarySE(df_feb22, measurevar="profit", groupvars=c("year","group"))
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.1) +
geom_line(aes(linetype=group, color=group)) +
geom_point()
dfs
df_feb22<- read.csv("S:/æˆ‘çš„åšæžœäº?æˆ‘çš„åšæžœäº?é«˜ä¼Ÿ/ç¨Žè´Ÿè½¬å«é—®é¢˜/mineVSindus13_Feb22.csv",
header=TRUE, stringsAsFactors=FALSE,sep=",")
head(df_feb22)
dfs <- summarySE(df_feb22, measurevar="LPE", groupvars=c("year","group"))
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.1) +
geom_line(aes(linetype=group, color=group)) +
geom_point()
dfs <- summarySE(df_feb22, measurevar="lpe", groupvars=c("year","group"))
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.1) +
geom_line(aes(linetype=group, color=group)) +
geom_point()
df_feb22<- read.csv("S:/æˆ‘çš„åšæžœäº?æˆ‘çš„åšæžœäº?é«˜ä¼Ÿ/ç¨Žè´Ÿè½¬å«é—®é¢˜/mineVSindus13_Feb22.csv",
header=TRUE, stringsAsFactors=FALSE,sep=",")
head(df_feb22)
dfs <- summarySE(df_feb22, measurevar="lpe", groupvars=c("year","group"))
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.1) +
geom_line(aes(linetype=group, color=group)) +
geom_point()
View(data.price)
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.1) +
geom_line(aes(linetype=group, color=group),size = 1) +
geom_point()
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.5) +
geom_line(aes(linetype=group, color=group),size = 1) +
geom_point()
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.3) +
geom_line(aes(linetype=group, color=group),size = 1) +
geom_point()
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.2) +
geom_line(aes(linetype=group, color=group),size = 1) +
geom_point()
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.2) +
geom_line(aes(linetype=group, color=group),size = 2) +
geom_point()
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.2, size=1) +
geom_line(aes(linetype=group, color=group),size = 2) +
geom_point()
df_feb22<- read.csv("S:/æˆ‘çš„åšæžœäº?æˆ‘çš„åšæžœäº?é«˜ä¼Ÿ/ç¨Žè´Ÿè½¬å«é—®é¢˜/mineVSindus13_Feb22.csv",
header=TRUE, stringsAsFactors=FALSE,sep=",")
head(df_feb22)
dfs <- summarySE(df_feb22, measurevar="lpe", groupvars=c("year","group"))
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.2, size=1) +
geom_line(aes(linetype=group, color=group),size = 2) +
geom_point()
library(ggplot2)
df_feb22<- read.csv("S:/æˆ‘çš„åšæžœäº?æˆ‘çš„åšæžœäº?é«˜ä¼Ÿ/ç¨Žè´Ÿè½¬å«é—®é¢˜/mineVSindus13_Feb22.csv",
header=TRUE, stringsAsFactors=FALSE,sep=",")
head(df_feb22)
dfs <- summarySE(df_feb22, measurevar="lpe", groupvars=c("year","group"))
ggplot(dfs, aes(x=year, y=lpe, colour=group)) +
geom_errorbar(aes(ymin=lpe-se, ymax=lpe+se), width=.2, size=1) +
geom_line(aes(linetype=group, color=group),size = 2) +
geom_point()
capabilities()
capabilities()
install.packages(c("Rcpp","devtools","dplyr","plyr"))
install.packages(c("Seurat"))
install.packages(c(""))
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install()
BiocManager::install(c("GenomicFeatures", "AnnotationDbi"))
q()
setwd("E:/code/mmuMSigDB")
#Author: Minghui Wang
read.gmt=function(filename){
if(! file.exists(filename)) stop('File ',filename,' not available\n')
dat=readLines(filename)
n=length(dat)
res=list(genesets=vector(mode = "list", length = n),geneset.names=vector(mode = "character", length = n),geneset.descriptions=vector(mode = "character", length = n))
for(i in 1:n){
s=strsplit(dat[i],'\t')[[1]]
res$genesets[[i]]=s[-c(1:2)]
res$geneset.names[i]=s[1]
res$geneset.descriptions[i]=s[2]
}
names(res$genesets)=res$geneset.names
res
}
#
write.gmt=function(obj,filename){
conn=file(filename,'w')
for(i in 1:length(obj$genesets)){
cat(obj$geneset.names[i],obj$geneset.descriptions[i],obj$genesets[[i]],file=conn,sep='\t')
cat('\n',file=conn)
}
close(conn)
return(invisible())
}
c2.cp <- read.gmt(filename = "./msigdb_v7/c2.cp.v7.0.symbols.gmt")
c5.bp <- read.gmt(filename = "./msigdb_v7/c5.bp.v7.0.symbols.gmt")
c7.all<- read.gmt(filename = "./msigdb_v7/c7.all.v7.0.symbols.gmt")
length(c2.cp$genesets)
msigdb.gene.symbols <- unique(
c(unique(unlist(c2.cp$genesets)),
unique(unlist(c5.bp$genesets)),
unique(unlist(c7.all$genesets))) )
msigdb.gene.symbols
c2.cp
class(c2.cp)
names(c2.cp)
c2.cp$geneset.descriptions
c2.cp$geneset.names
c2.cp$geneset
c2.cp$genesets
c2.cp$genesets[[1]]
length(c2.cp)
length(c2.cp$genesets)
cat(gsid)
for (gsid in 1:length(c2.cp$genesets)){
cat(gsid)
}
print(gsid)
for (gsid in 1:length(c2.cp$genesets)){
print(gsid)
}
print(gsid)
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
print(gsid)
}
print(gs[[gsid]])
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
print(gs[[gsid]])
}
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
print(names(gs[[gsid]]))
}
gs[[1000]]
gs <-c2.cp
gs[[1000]]
print(names(gs$genesets[[gsid]]))
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
print(names(gs$genesets[[gsid]]))
}
gs$genesets
class(gs$genesets)
gs$genesets[[1]]
gs$genesets[[100]]
gs$genesets[[1000]]
gs$genesets[[10000]]
gs$genesets[[3000]]
gs$genesets[[2000]]
length(gs$genesets)
gs$genesets[[2199]]
gs$genesets[[2200]]
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
print(names(gs$genesets[[gsid]]))
}
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
print(gs$genesets[[gsid]])
}
print(length(gvec))
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
gvec<-gs$genesets[[gsid]]
print(length(gvec))
}
print((gvec))
gvec
gvec[1]
gvec
for (gene in gvec){
gvec
}
for (gene in gvec){
print(gvec)
}
gvec[gvec=="CD79B"]
gvec[gvec=="CD79B"]<-"Cd79b"
gvec
gvec<-gvec[gvec!="Cd79b"]
gvec
human2mouse
human = useMart("ensembl", dataset = "hsapiens_gene_ensembl")
mouse = useMart("ensembl", dataset = "mmusculus_gene_ensembl")
human = useMart("ensembl", dataset = "hsapiens_gene_ensembl")
setwd("E:/code/mmuMSigDB")
#Author: Minghui Wang
read.gmt=function(filename){
if(! file.exists(filename)) stop('File ',filename,' not available\n')
dat=readLines(filename)
n=length(dat)
res=list(genesets=vector(mode = "list", length = n),geneset.names=vector(mode = "character", length = n),geneset.descriptions=vector(mode = "character", length = n))
for(i in 1:n){
s=strsplit(dat[i],'\t')[[1]]
res$genesets[[i]]=s[-c(1:2)]
res$geneset.names[i]=s[1]
res$geneset.descriptions[i]=s[2]
}
names(res$genesets)=res$geneset.names
res
}
#
write.gmt=function(obj,filename){
conn=file(filename,'w')
for(i in 1:length(obj$genesets)){
cat(obj$geneset.names[i],obj$geneset.descriptions[i],obj$genesets[[i]],file=conn,sep='\t')
cat('\n',file=conn)
}
close(conn)
return(invisible())
}
c2.cp <- read.gmt(filename = "./msigdb_v7/c2.cp.v7.0.symbols.gmt")
c5.bp <- read.gmt(filename = "./msigdb_v7/c5.bp.v7.0.symbols.gmt")
c7.all<- read.gmt(filename = "./msigdb_v7/c7.all.v7.0.symbols.gmt")
length(c2.cp$genesets)
msigdb.gene.symbols <- unique(
c(unique(unlist(c2.cp$genesets)),
unique(unlist(c5.bp$genesets)),
unique(unlist(c7.all$genesets))) )
msigdb.gene.symbols
human = useMart("ensembl", dataset = "hsapiens_gene_ensembl")
mouse = useMart("ensembl", dataset = "mmusculus_gene_ensembl")
human = useMart("ensembl", dataset = "hsapiens_gene_ensembl")
mouse = useMart("ensembl", dataset = "mmusculus_gene_ensembl")
library("biomaRt")
human = useMart("ensembl", dataset = "hsapiens_gene_ensembl")
mouse = useMart("ensembl", dataset = "mmusculus_gene_ensembl")
human2mouse = getLDS(attributes = c("hgnc_symbol","ensembl_gene_id","entrezgene_id"), mart = human,
attributesL = c("mgi_symbol","ensembl_gene_id","entrezgene_id"), martL = mouse, uniqueRows=T)
human2mouse
human2mouse
gene
human2mouse$HGNC.symbol==gene
human2mouse[human2mouse$HGNC.symbol==gene, ]
unique(human2mouse$HGNC.symbol)
human2mouse[human2mouse$HGNC.symbol==gene, ]$MGI.symbol
human2mouse[human2mouse$HGNC.symbol==gene, ]$MGI.symbol
human2mouse[human2mouse$HGNC.symbol==gene, ]$MGI.symbol[1]
gene.rowsel      <-  human2mouse$HGNC.symbol==gene
symbol.converted <-( human2mouse[gene.rowsel, ]$MGI.symbol ) [1]  # if multiple hits exist, use first one. (just in case)
symbol.converted
symbol.converted
symbol.converted!="" & !is.na(symbol.converted)
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
gvec<-gs$genesets[[gsid]]
# go through all genes in one gene set
for (gene in gvec){
gene.rowsel      <-  human2mouse$HGNC.symbol==gene
symbol.converted <-( human2mouse[gene.rowsel, ]$MGI.symbol ) [1]  # if multiple hits exist, use first one. (just in case)
if ( symbol.converted!="" & !is.na(symbol.converted) ){ # if conversion found
gvec[gvec==gene] <- replaced
}else{ # or removed the unmatched item
gvec<-gvec[gvec!=gene]
}
}
gs$genesets[[gsid]] <- gvec
}
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
gvec<-gs$genesets[[gsid]]
# go through all genes in one gene set
for (gene in gvec){
gene.rowsel      <-  human2mouse$HGNC.symbol==gene
symbol.converted <-( human2mouse[gene.rowsel, ]$MGI.symbol ) [1]  # if multiple hits exist, use first one. (just in case)
if ( symbol.converted!="" & !is.na(symbol.converted) ){ # if conversion found
gvec[gvec==gene] <- symbol.converted
}else{ # or removed the unmatched item
gvec<-gvec[gvec!=gene]
}
}
gs$genesets[[gsid]] <- gvec
}
gs <-c2.cp
for (gsid in 1:length(gs$genesets)){
print(gsid)
gvec<-gs$genesets[[gsid]]
# go through all genes in one gene set
for (gene in gvec){
gene.rowsel      <-  human2mouse$HGNC.symbol==gene
symbol.converted <-( human2mouse[gene.rowsel, ]$MGI.symbol ) [1]  # if multiple hits exist, use first one. (just in case)
if ( symbol.converted!="" & !is.na(symbol.converted) ){ # if conversion found
gvec[gvec==gene] <- symbol.converted
}else{ # or removed the unmatched item
gvec<-gvec[gvec!=gene]
}
}
gs$genesets[[gsid]] <- gvec
}
gs
gs[[1]]
gs$genesets[[1]]
c2.cp$genesets[[1]]
c2.cp$genesets[[2]]
gs$genesets[[2]]
names(gs)
write.gmt(obj = gs, filename = "c2.cp.mmu.v7.0.symbols.gmt")
rm(list = ls())
rm(gs)
rm(list = ls())
#Author: Minghui Wang
read.gmt=function(filename){
if(! file.exists(filename)) stop('File ',filename,' not available\n')
dat=readLines(filename)
n=length(dat)
res=list(genesets=vector(mode = "list", length = n),geneset.names=vector(mode = "character", length = n),geneset.descriptions=vector(mode = "character", length = n))
for(i in 1:n){
s=strsplit(dat[i],'\t')[[1]]
res$genesets[[i]]=s[-c(1:2)]
res$geneset.names[i]=s[1]
res$geneset.descriptions[i]=s[2]
}
names(res$genesets)=res$geneset.names
res
}
#
write.gmt=function(obj,filename){
conn=file(filename,'w')
for(i in 1:length(obj$genesets)){
cat(obj$geneset.names[i],obj$geneset.descriptions[i],obj$genesets[[i]],file=conn,sep='\t')
cat('\n',file=conn)
}
close(conn)
return(invisible())
}
c2.cp <- read.gmt(filename = "./msigdb_v7/c2.cp.v7.0.symbols.gmt")
c5.bp <- read.gmt(filename = "./msigdb_v7/c5.bp.v7.0.symbols.gmt")
c7.all<- read.gmt(filename = "./msigdb_v7/c7.all.v7.0.symbols.gmt")
human = useMart("ensembl", dataset = "hsapiens_gene_ensembl")
mouse = useMart("ensembl", dataset = "mmusculus_gene_ensembl")
human2mouse = getLDS(attributes = c("hgnc_symbol","ensembl_gene_id","entrezgene_id"), mart = human,
attributesL = c("mgi_symbol","ensembl_gene_id","entrezgene_id"), martL = mouse, uniqueRows=T)
library("biomaRt")
human = useMart("ensembl", dataset = "hsapiens_gene_ensembl")
mouse = useMart("ensembl", dataset = "mmusculus_gene_ensembl")
human2mouse = getLDS(attributes = c("hgnc_symbol","ensembl_gene_id","entrezgene_id"), mart = human,
attributesL = c("mgi_symbol","ensembl_gene_id","entrezgene_id"), martL = mouse, uniqueRows=T)
# ====================== Conversion  ==========================
gs <-c2.cp
library(progress)
pb <- progress_bar$new(total = length(gs$genesets))
for (gsid in 1:length(gs$genesets)){
print(gsid)
gvec<-gs$genesets[[gsid]]
# go through all genes in one gene set
for (gene in gvec){
gene.rowsel      <-  human2mouse$HGNC.symbol==gene
symbol.converted <-( human2mouse[gene.rowsel, ]$MGI.symbol ) [1]  # if multiple hits exist, use first one. (just in case)
if ( symbol.converted!="" & !is.na(symbol.converted) ){ # if conversion found
gvec[gvec==gene] <- symbol.converted
}else{ # or removed the unmatched item
gvec<-gvec[gvec!=gene]
}
}
gs$genesets[[gsid]] <- gvec
pb$tick()
}
# ====================== Conversion  ==========================
gs <-c2.cp
pb <- progress_bar$new(total = length(gs$genesets))
for (gsid in 1:length(gs$genesets)){
gvec<-gs$genesets[[gsid]]
# go through all genes in one gene set
for (gene in gvec){
gene.rowsel      <-  human2mouse$HGNC.symbol==gene
symbol.converted <-( human2mouse[gene.rowsel, ]$MGI.symbol ) [1]  # if multiple hits exist, use first one. (just in case)
if ( symbol.converted!="" & !is.na(symbol.converted) ){ # if conversion found
gvec[gvec==gene] <- symbol.converted
}else{ # or removed the unmatched item
gvec<-gvec[gvec!=gene]
}
}
gs$genesets[[gsid]] <- gvec
pb$tick()
}
write.gmt(obj = gs, filename = "c2.cp.mmu.v7.0.symbols.gmt")
rm(gs)
# ====================== Conversion for C5.BP ==========================
gs <-c5.bp
library(progress)
pb <- progress_bar$new(total = length(gs$genesets))
for (gsid in 1:length(gs$genesets)){
gvec<-gs$genesets[[gsid]]
# go through all genes in one gene set
for (gene in gvec){
gene.rowsel      <-  human2mouse$HGNC.symbol==gene
symbol.converted <-( human2mouse[gene.rowsel, ]$MGI.symbol ) [1]  # if multiple hits exist, use first one. (just in case)
if ( symbol.converted!="" & !is.na(symbol.converted) ){ # if conversion found
gvec[gvec==gene] <- symbol.converted
}else{ # or removed the unmatched item
gvec<-gvec[gvec!=gene]
}
}
gs$genesets[[gsid]] <- gvec
pb$tick()
}
write.gmt(obj = gs, filename = "c2.cp.mmu.v7.0.symbols.gmt")
rm(gs)
gs <-c2.cp
library(progress)
pb <- progress_bar$new(total = length(gs$genesets))
for (gsid in 1:length(gs$genesets)){
gvec<-gs$genesets[[gsid]]
# go through all genes in one gene set
for (gene in gvec){
gene.rowsel      <-  human2mouse$HGNC.symbol==gene
symbol.converted <-( human2mouse[gene.rowsel, ]$MGI.symbol ) [1]  # if multiple hits exist, use first one. (just in case)
if ( symbol.converted!="" & !is.na(symbol.converted) ){ # if conversion found
gvec[gvec==gene] <- symbol.converted
}else{ # or removed the unmatched item
gvec<-gvec[gvec!=gene]
}
}
gs$genesets[[gsid]] <- gvec
pb$tick()
}
write.gmt(obj = gs, filename = "c2.cp.mmu.v7.0.symbols.gmt")
rm(gs)
gs <-c7.all
library(progress)
pb <- progress_bar$new(total = length(gs$genesets))
for (gsid in 1:length(gs$genesets)){
gvec<-gs$genesets[[gsid]]
# go through all genes in one gene set
for (gene in gvec){
gene.rowsel      <-  human2mouse$HGNC.symbol==gene
symbol.converted <-( human2mouse[gene.rowsel, ]$MGI.symbol ) [1]  # if multiple hits exist, use first one. (just in case)
if ( symbol.converted!="" & !is.na(symbol.converted) ){ # if conversion found
gvec[gvec==gene] <- symbol.converted
}else{ # or removed the unmatched item
gvec<-gvec[gvec!=gene]
}
}
gs$genesets[[gsid]] <- gvec
pb$tick()
}
write.gmt(obj = gs, filename = "c7.all.mmu.v7.0.symbols.gmt")
rm(gs)
